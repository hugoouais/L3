#!/bin/bash
# Teste la politique de mot de passe pwquality uniquement en Bash

USER=testuser

# Crée l'utilisateur s'il n'existe pas
if ! id "$USER" &>/dev/null; then
    echo "[INFO] Création de l'utilisateur $USER"
    sudo useradd -M -s /usr/sbin/nologin "$USER"
fi

# Liste de mots de passe à tester
PASSWORDS=(
  "password"              # trop faible
  "Password123"           # manque caractère spécial
  "Password123!"          # encore trop simple
  "UltraSecure2025!"      # conforme
  "Abc!12345678Xyz"       # conforme
)

echo "=== Test des mots de passe avec pwquality ==="

for pw in "${PASSWORDS[@]}"; do
    if echo "$USER:$pw" | sudo chpasswd 2>/dev/null; then
        echo "[VALIDE]   $pw"
    else
        echo "[INVALIDE] $pw"
    fi
done
